<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>

    <!-- GOOGLE FONT -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>

    <!-- BOOTSTRAP CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- MAIN STYLE FILE -->
    <link rel="stylesheet" href="/css/style.css" />

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }

        .navbar {
            background-color: #343a40;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .navbar .active {
            color: #00ff88;
            text-decoration: none;
            font-weight: 600;
        }

        .user-badge {
            background-color: #00ff88;
            color: #000;
            font-weight: 600;
            padding: 0.5rem 0.7rem;
            border-radius: 50%;
            text-align: center;
        }

        .dashboard-container h1 {
            margin-top: 20px;
            font-weight: 500;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }

        .dashboard-grid .card {
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .btn {
            font-weight: 500;
        }

        .btn-success {
            background-color: #00ff88;
            border: none;
            color: #000;
        }

        .btn-success:hover {
            background-color: #00e676;
            color: #000;
        }

        .btn-danger {
            background-color: #ff6b6b;
            border: none;
            color: #fff;
        }

        .btn-danger:hover {
            background-color: #ff5252;
            color: #fff;
        }

        .btn-primary {
            background-color: #00ff88;
            border: none;
        }

        .btn-primary:hover {
            background-color: #00e676;
        }

        table th, table td {
            vertical-align: middle;
        }

        .card-title {
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="nav-left">
            <a href="/dashboard" class="active">SPENDING OVERVIEW</a>
        </div>

        <!-- Add this anywhere in your dashboard header or nav -->
        <form action="/logout" method="GET" style="display:inline;">
         <button type="submit" class="btn btn-danger">Logout</button>
        </form>

    </nav>

<div class="main-wrapper">
    <div class="container mt-4">
        <h1>Welcome Back, <span class="name"><%= user.name %></span> ü´∞</h1> <br>

        <!-- BUTTONS -->
        <div class="d-flex flex-wrap gap-2 mt-4">
            <a href="/transactions?type=income" class="btn btn-success flex-fill flex-md-auto">New Income üí∞</a>
            <a href="/transactions?type=expense" class="btn btn-danger flex-fill flex-md-auto">New Expense üòì</a>
            <a href="/monthlysummary" class="btn btn-success flex-fill flex-md-auto">Monthly Summary ‚è≥</a>
        </div> <br>

        <!-- STATS GRID -->
        <div class="dashboard-grid my-4">
            <div class="card text-center p-3">
                <p class="card-title">Remaining</p>
                <h2>‚Çπ <%= stats.balance.toLocaleString() %></h2>
            </div>

            <div class="card text-center p-3">
                <p class="card-title">Total Income</p>
                <h2 style="color:#00ff88;">‚Çπ <%= stats.totalIncome.toLocaleString() %></h2>
            </div>

            <div class="card text-center p-3">
                <p class="card-title">Total Expense</p>
                <h2 style="color:red;">‚Çπ <%= stats.totalExpense.toLocaleString() %></h2>
            </div>
        </div><br>

        <!-- FILTER / SORT -->
        <div class="card p-3 my-3 shadow-sm">
            <h3>Filter / Sort Transactions</h3>
            <form method="GET" action="/dashboard" class="row g-2 align-items-center">
                <div class="col-md-3 col-6">
                    <select name="type" class="form-select">
                        <option value="">All</option>
                        <option value="income" <%= filterType === "income" ? "selected" : "" %>>Income</option>
                        <option value="expense" <%= filterType === "expense" ? "selected" : "" %>>Expense</option>
                    </select>
                </div>
                <div class="col-md-3 col-6">
                    <select name="sort" class="form-select">
                        <option value="newest" <%= sort === "newest" ? "selected" : "" %>>Newest</option>
                        <option value="oldest" <%= sort === "oldest" ? "selected" : "" %>>Oldest</option>
                        <option value="amountAsc" <%= sort === "amountAsc" ? "selected" : "" %>>Amount ‚Üë</option>
                        <option value="amountDesc" <%= sort === "amountDesc" ? "selected" : "" %>>Amount ‚Üì</option>
                    </select>
                </div>
                <div class="col-md-3 col-6">
                    <button type="submit" class="btn btn-success w-100">Apply</button>
                </div>
            </form>
        </div><br>

        <!-- TRANSACTIONS TABLE -->
        <div class="card p-3 my-3 shadow-sm">
            <h3>Transactions</h3>
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Category</th>
                            <th>Note</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% transactions.forEach(tx => { %>
                            <tr>
                                <td><%= new Date(tx.date).toLocaleDateString('en-US', { day: '2-digit', month: 'short', year: 'numeric', weekday: 'short' }) %></td>
                                <td><span class="<%= tx.type === 'income' ? 'text-success' : 'text-danger' %>"><%= tx.type %></span></td>
                                <td>‚Çπ <%= tx.amount %></td>
                                <td><%= tx.category %></td>
                                <td><%= tx.note %></td>
                                <td>
                                    <form action="/dashboard/transactions/delete/<%= tx._id %>" method="POST">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

    <!-- BOOTSTRAP JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <footer class="footer mt-5 py-3 text-center">
  <p class="mb-0">üí∞ Spend Wisely. Track Smartly.</p>
  <small><b>Built with ‚ù§Ô∏è by Divya!</b></small>
  </footer>
</body>
</html>
